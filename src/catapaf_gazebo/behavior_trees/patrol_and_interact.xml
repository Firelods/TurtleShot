<root BTCPP_format="4">
    <BehaviorTree ID="MainTree">
        <Sequence>
             <!-- Step 1: Detect and go to human -->
             <DetectHumanWithBall output_pose="{human_pose}" is_detected="{human_found}"/>
             
             <GoToPose target="{human_pose}"/>
             
             <!-- Step 2: Stop -->
             <StopRobot/>
             
             <!-- Step 3: Wait 30 seconds -->
             <Wait duration="30"/>
             
             <!-- Step 4: Step back -->
             <StepBack distance="0.5"/>
             
             <!-- Step 5 & 6: Random walk while searching for trash -->
             <!-- Parallel node runs both RandomWalk and trash detection simultaneously -->
             <!-- SuccessOnOne: If trash is detected (Retry succeeds), Parallel succeeds and halts RandomWalk -->
             <Parallel success_count="1" failure_count="1">
                 <RetryUntilSuccessful num_attempts="-1">
                     <DetectTrashCan output_pose="{trash_pose}" is_detected="{trash_found}"/>
                 </RetryUntilSuccessful>
                 <RandomWalk/>
             </Parallel>
             
             <StopRobot/>
             
             <!-- Step 7: Go to trash -->
             <GoToPose target="{trash_pose}"/>
             
             <!-- Step 8: Trigger arm -->
             <TriggerArm/>
        </Sequence>
    </BehaviorTree>

    <!-- Definition of custom nodes for Groot2 visualization -->
    <TreeNodesModel>
        <Action ID="DetectTrashCan">
            <output_port name="output_pose">Pose of the detected trashcan</output_port>
            <output_port name="is_detected">Boolean flag if detected</output_port>
        </Action>
        <Action ID="DetectHumanWithBall">
            <output_port name="output_pose">Pose of the human with ball</output_port>
            <output_port name="is_detected">Boolean flag if detected</output_port>
        </Action>
        <Action ID="GoToPose">
            <input_port name="target">Target 3D Pose</input_port>
        </Action>
        <Action ID="StopRobot"/>
        <Action ID="Wait">
            <input_port name="duration">Duration in seconds</input_port>
        </Action>
        <Action ID="GetPatrolPoint">
            <output_port name="output_pose">Next patrol waypoint pose</output_port>
        </Action>
        <Action ID="RandomWalk"/>
        <Action ID="StepBack">
            <input_port name="distance">Distance to step back in meters</input_port>
        </Action>
        <Action ID="TriggerArm"/>
    </TreeNodesModel>
</root>
